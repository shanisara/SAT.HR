@model SAT.HR.Models.BonusCalculatorViewModel

<div>
    <h4 class="card-title"><span>ตรวจสอบและแก้ไข</span></h4>
    <p class="card-category"> รายการคำนวณโบนัสประจำปี </p>
</div>
<div>
    <table id="datatables" data-url="@Url.Content("~/payroll/BonusCalculator")" class="table table-striped table-no-bordered table-hover" cellspacing="0">
        <thead>
            <tr>
                <th style="width:60px;text-align:center;" class="disabled-sorting">ลำดับ</th>
                <th style="width:90px;text-align:center;">ปีบัญชี</th>
                <th style="width:400px">ชื่อ นามสกุล</th>
                <th style="width:120px;text-align:center;">เงินเดือน</th>
                <th style="width:80px;text-align:center;">อัตรา</th>
                <th style="width:100px;text-align:center;">โบนัส</th>
                <th style="width:60px;text-align:center;" class="disabled-sorting">แก้ไข</th>
                <th style="width:100px;text-align:center;">m10</th>
                <th style="width:100px;text-align:center;">m11</th>
                <th style="width:100px;text-align:center;">m12</th>
                <th style="width:100px;text-align:center;">m1</th>
                <th style="width:100px;text-align:center;">m2</th>
                <th style="width:100px;text-align:center;">m3</th>
                <th style="width:100px;text-align:center;">m4</th>
                <th style="width:100px;text-align:center;">m5</th>
                <th style="width:100px;text-align:center;">m6</th>
                <th style="width:100px;text-align:center;">m7</th>
                <th style="width:100px;text-align:center;">m8</th>
                <th style="width:100px;text-align:center;">m9</th>

            </tr>
        </thead>
        <tbody>
            @if (Model != null)
                {
                    for (int i = 0; i < Model.Step2.Count; i++)
                    {
                <tr id="@Model.Step2[i].UserID">
                    <td style="width:60px;text-align:center;">@(i + 1)</td>
                    <td style="width:90px;text-align:center;">@Model.Step2[i].Year</td>
                    <td style="width:400px">@Model.Step2[i].FullNameTh</td>
                    <td style="width:120px;color:blue;text-align:right;">@Model.Step2[i].Salary</td>
                    <td style="width:80px;text-align:center;">@Model.Step2[i].UpStep</td>
                    <td style="width:100px;color:red;text-align:right;">@Model.Step2[i].Bonus</td>
                    <td style="width:60px;text-align:center;">
                        <div class="td-actions pull-center">
                            <button data-id="@Model.Step2[i].UserID" data-step="@Model.Step2[i].UpStep" data-bonus="@Model.Step2[i].Bonus" data-year="@Model.Step2[i].Year" data-fullname="@Model.Step2[i].FullNameTh" title="ลบ" type="button" rel="tooltip" class="btn btn-round btn-success btn-edit">
                                <i class="material-icons">edit</i>
                            </button>
                        </div>
                    </td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M10</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M11</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M12</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M1</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M2</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M3</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M4</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M5</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M6</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M7</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M8</td>
                    <td style="width:100px;text-align:right;">@Model.Step2[i].M9</td>
                    <td class="hidden">
                        @Html.HiddenFor(model => model.Step2[i].UserID)
                        @Html.HiddenFor(model => model.Step2[i].Seq)
                        @Html.HiddenFor(model => model.Step2[i].UpStep)
                        @Html.HiddenFor(model => model.Step2[i].Year)
                        @Html.HiddenFor(model => model.Step2[i].FullNameTh)
                        @Html.HiddenFor(model => model.Step2[i].M1)
                        @Html.HiddenFor(model => model.Step2[i].M2)
                        @Html.HiddenFor(model => model.Step2[i].M3)
                        @Html.HiddenFor(model => model.Step2[i].M4)
                        @Html.HiddenFor(model => model.Step2[i].M5)
                        @Html.HiddenFor(model => model.Step2[i].M6)
                        @Html.HiddenFor(model => model.Step2[i].M7)
                        @Html.HiddenFor(model => model.Step2[i].M8)
                        @Html.HiddenFor(model => model.Step2[i].M9)
                        @Html.HiddenFor(model => model.Step2[i].M10)
                        @Html.HiddenFor(model => model.Step2[i].M11)
                        @Html.HiddenFor(model => model.Step2[i].M12)
                        @Html.HiddenFor(model => model.Step2[i].Salary, new { @class = "new-salary" })
                        @Html.HiddenFor(model => model.Step2[i].Bonus, new { @class = "new-bonus" })
                    </td>
                </tr>
                    }
                }
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {

        $("#datatables").on('click', '.btn-edit', function () {
            var userid = $(this).data("id");
            var step = $(this).data("step");
            var bonus = $(this).data("bonus");
            var year = $(this).data("year");
            var fullname = $(this).data("fullname");

            var url = '@Url.Action("BonusCalculatorEdit", "Payroll")';
            $.post(url, { userid: userid, step: step, bonus: bonus, year: year, fullname: fullname }, function (data) {
                $(".div-detail").html(data);
                $('.modal-detail').modal('show');
            });

        });

        $(".btn-save-bonus").click(function () {
            debugger;
            var id = $('#UserID').val();
            var new_step = $('#UpStep').val();
            var new_bonus = $('#Bonus').val();

            $('#' + id).find("td:eq(4)").html(new_step);
            $('#' + id).find("td:eq(5)").html(new_bonus);

            $('#' + id).find("input[class='new-salary']").val(new_step);
            $('#' + id).find("input[class='new-bonus']").val(new_bonus.replace(/,/g, '-'));

            $('.modal-detail').modal('hide');
        });

    });

</script>