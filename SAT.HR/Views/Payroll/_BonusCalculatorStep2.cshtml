@model SAT.HR.Models.BonusCalculatorViewModel

<div class="card">
    <div class="card-header">
        <h4 class="card-title"><span>ตรวจสอบและแก้ไข</span></h4>
        <p class="card-category"> รายการคำนวณโบนัสประจำปี </p>
        <div class="toolbar pull-right" style="margin-top: -50px;">
            <button class="btn btn-primary btn-sm btn-export-excel" data-toggle="modal">Export</button>
        </div>
    </div>
    <div class="card-body">
        <div>
            <table id="datatables" data-url="@Url.Content("~/payroll/BonusCalculator")" class="table table-striped table-no-bordered table-hover" cellspacing="0" style="width:1500px; height:500px">
                <thead>
                    <tr>
                        <th style="width:60px" class="disabled-sorting">ลำดับ</th>
                        <th style="width:75px">ปีบัญชี</th>
                        <th style="width:200px">ชื่อ นามสกุล</th>
                        <th style="width:100px">เงินเดือน</th>
                        <th style="width:75px">อัตรา</th>
                        <th style="width:100px">โบนัส</th>
                        <th style="width:60px" class="disabled-sorting">แก้ไข</th>
                        <th style="width:100px">m10</th>
                        <th style="width:100px">m11</th>
                        <th style="width:100px">m12</th>
                        <th style="width:100px">m1</th>
                        <th style="width:100px">m2</th>
                        <th style="width:100px">m3</th>
                        <th style="width:100px">m4</th>
                        <th style="width:100px">m5</th>
                        <th style="width:100px">m6</th>
                        <th style="width:100px">m7</th>
                        <th style="width:100px">m8</th>
                        <th style="width:100px">m9</th>

                    </tr>
                </thead>
                <tbody>
                    @if (Model != null)
                    {
                        for (int i = 0; i < Model.Step2.Count; i++)
                        {
                            <tr id="@Model.Step2[i].UserID">
                                <td style="width:60px">@(i + 1)</td>
                                <td style="width:75px">@Model.Step2[i].Year</td>
                                <td style="width:200px">@Model.Step2[i].FullNameTh</td>
                                <td style="width:100px;color:blue;">@Model.Step2[i].Salary</td>
                                <td style="width:75px">@Model.Step2[i].UpStep</td>
                                <td style="width:100px;color:red;">@Model.Step2[i].Bonus</td>
                                <td style="width:60px">
                                    <div class="td-actions pull-center">
                                        <button data-id="@Model.Step2[i].UserID" data-step="@Model.Step2[i].UpStep" data-bonus="@Model.Step2[i].Bonus" data-year="@Model.Step2[i].Year" data-fullname="@Model.Step2[i].FullNameTh" title="ลบ" type="button" rel="tooltip" class="btn btn-round btn-success btn-edit">
                                            <i class="material-icons">edit</i>
                                        </button>
                                    </div>
                                </td>
                                <td style="width:100px">@Model.Step2[i].M10</td>
                                <td style="width:100px">@Model.Step2[i].M11</td>
                                <td style="width:100px">@Model.Step2[i].M12</td>
                                <td style="width:100px">@Model.Step2[i].M1</td>
                                <td style="width:100px">@Model.Step2[i].M2</td>
                                <td style="width:100px">@Model.Step2[i].M3</td>
                                <td style="width:100px">@Model.Step2[i].M4</td>
                                <td style="width:100px">@Model.Step2[i].M5</td>
                                <td style="width:100px">@Model.Step2[i].M6</td>
                                <td style="width:100px">@Model.Step2[i].M7</td>
                                <td style="width:100px">@Model.Step2[i].M8</td>
                                <td style="width:100px">@Model.Step2[i].M9</td>
                                <td class="hidden">
                                    @Html.HiddenFor(model => model.Step2[i].UserID)
                                    @Html.HiddenFor(model => model.Step2[i].Year)
                                    @Html.HiddenFor(model => model.Step2[i].FullNameTh)
                                    @Html.HiddenFor(model => model.Step2[i].M1)
                                    @Html.HiddenFor(model => model.Step2[i].M2)
                                    @Html.HiddenFor(model => model.Step2[i].M3)
                                    @Html.HiddenFor(model => model.Step2[i].M4)
                                    @Html.HiddenFor(model => model.Step2[i].M5)
                                    @Html.HiddenFor(model => model.Step2[i].M6)
                                    @Html.HiddenFor(model => model.Step2[i].M7)
                                    @Html.HiddenFor(model => model.Step2[i].M8)
                                    @Html.HiddenFor(model => model.Step2[i].M9)
                                    @Html.HiddenFor(model => model.Step2[i].M10)
                                    @Html.HiddenFor(model => model.Step2[i].M11)
                                    @Html.HiddenFor(model => model.Step2[i].M12)
                                    @Html.HiddenFor(model => model.Step2[i].Salary, new { @class = "new-salary" })
                                    @Html.HiddenFor(model => model.Step2[i].Bonus, new { @class = "new-bonus" })
                                </td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {

        $("#datatables").on('click', '.btn-edit', function () {
            var userid = $(this).data("id");
            var step = $(this).data("step");
            var bonus = $(this).data("bonus");
            var year = $(this).data("year");
            var fullname = $(this).data("fullname");

            var url = '@Url.Action("BonusCalculatorEdit", "Payroll")';
            $.post(url, { userid: userid, step: step, bonus: bonus, year: year, fullname: fullname }, function (data) {
                $(".div-detail").html(data);
                $('.modal-detail').modal('show');
            });

        });

        $(".btn-save-bonus").click(function () {
            debugger;
            var id = $('#UserID').val();
            var new_step = $('#UpStep').val();
            var new_bonus = $('#Bonus').val();

            $('#' + id).find("td:eq(4)").html(new_step);
            $('#' + id).find("td:eq(5)").html(new_bonus);

            $('#' + id).find("input[class='new-salary']").val(new_step);
            $('#' + id).find("input[class='new-bonus']").val(new_bonus);

            $('.modal-detail').modal('hide');
        });
        
        $(".btn-export-excel").click(function () {
            $(".btn-export").click();
        });

    });

</script>